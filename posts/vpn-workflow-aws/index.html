<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to actually setup VPN in AWS? | Varad Belwalkar</title>
<meta name=keywords content="AWS,VPN"><meta name=description content="Setting VPN in AWS is not straightforward!"><meta name=author content="Varad Belwalkar"><link rel=canonical href=https://belwalkarvarad.tech/posts/vpn-workflow-aws/><script defer data-domain=belwalkarvarad.tech src=/misc/js/script.js data-api=/misc/api/event></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><script></script><link crossorigin=anonymous href=/assets/css/stylesheet.4f6c284a5168491e386e284261babc93d54f28c24f58b131800365a8fa5995e3.css integrity="sha256-T2woSlFoSR44bihCYbq8k9VPKMJPWLExgANlqPpZleM=" rel="preload stylesheet" as=style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://belwalkarvarad.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://belwalkarvarad.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://belwalkarvarad.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://belwalkarvarad.tech/apple-touch-icon.png><link rel=mask-icon href=https://belwalkarvarad.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="How to actually setup VPN in AWS?"><meta property="og:description" content="Setting VPN in AWS is not straightforward!"><meta property="og:type" content="article"><meta property="og:url" content="https://belwalkarvarad.tech/posts/vpn-workflow-aws/"><meta property="og:image" content="https://belwalkarvarad.tech/images/preview.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-12T09:15:19+05:30"><meta property="article:modified_time" content="2023-12-18T13:31:04+05:30"><meta property="og:site_name" content="Varad Belwalkar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://belwalkarvarad.tech/images/preview.png"><meta name=twitter:title content="How to actually setup VPN in AWS?"><meta name=twitter:description content="Setting VPN in AWS is not straightforward!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://belwalkarvarad.tech/posts/"},{"@type":"ListItem","position":2,"name":"How to actually setup VPN in AWS?","item":"https://belwalkarvarad.tech/posts/vpn-workflow-aws/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to actually setup VPN in AWS?","name":"How to actually setup VPN in AWS?","description":"Setting VPN in AWS is not straightforward!","keywords":["AWS","VPN"],"articleBody":"What is a VPN in the first place? VPN is what it says: Virtual Private Network. but what does that exactly mean?\nSuppose you are using an internet connection available at your university and connecting to the internet. In this case, the university has a private network setup that allows you to access the internet, but here, You can definitely get traced because, well, ultimately, the traffic will be coming and going to your university’s main router, and of course, the ISP has records for that. and your university might as well keep records of what you are visiting through a firewall, which is a common scenario.\nBut with the VPN, you can get into a private network, but in this case, it is virtual in some other geographical region, which keeps your identity private (mostly!) Here, it is very hard to trace your identity and what you have visited when you are visiting a VPN.\nIf you are accessing a VPN at your university, the university will find a normal valid IP address that you are visiting, but mostly it doesn’t know it is a VPN and has no control over what you are accessing or how you are accessing it.\nIt is like you are virtually in that private network, i.e., your PC or laptop is in the private network, which is on some server that you don’t handle.\nFine, now that you understand how VPN works, let’s understand how AWS allows you to create a VPN and let you connect to it.\nWhen creating a VPN in AWS, you can do the following:\naccess private resources not routable on the internet. e.g., not having public IP. access internet securely to access some content that is restricted to your geographical location. have controlled connectivity for VPN clients to be able to access the internet. Only allow connectivity from your VPN for a particular resource and not from the internet, though the resources are publicly available. e.g., having administrative privileges work only when admins are connected via VPN and not exposing the admin API over the internet. etc. There are more use cases, of course, than this. But you get the point.\nWell, let’s dive deep into how everything fits together. When you need to create a VPN, what you are basically doing is creating a VPN service, which will let users connect to it. you can,\nrestrict which users can access the VPN using mutual authentication. restrict users over subnets and internet connectivity. VPN is, of course, over HTTPS, so who is going to provide the secure connection?\nVPN is a kind of lightweight service that listens to client connection requests and, based on the required authentication, lets users connect to it.\nBut to provide a secure connection, you need an SSL certificate, right?\nYou can request a certificate from the AWS certificate manager, but wait, should you do it?\nRequesting a certificate from the AWS Cert Manager will authorize a certificate for a domain. Supposing you have bought the example.com domain, setup static hosting on the S3 bucket, and want to secure your client connections, you request a certificate from Cert Manager. where you prove your domain ownership. So then you can use that certificate in CloudFront to secure your domain.\nBut here is the catch: your clients can get the secure connection when they connect to your domain, which you have validated when requesting the certificate, right?\nBut when you create a VPN client in AWS that has a different endpoint, something like,\ncvpn-endpoint-06cfc1ca6ccea985c.prod.clientvpn.us-east-1.amazonaws.com This is the endpoint that I got when I created a client VPN.\nSo, how do you handle this domain? Is there any point in requesting a certificate from AWS for this domain? Of course not!\nWhat you simply need to do is create a custom certificate and sign it with a certificate authority of your own!\nCreate client and server certificates on your Linux machine. To create client and server certificates, you must have a certificate authority that signs those certificates, right?\nHere understand that we need to have mutual authentication, meaning we also need to authorize the clients that are connecting to the VPN and allow only them to connect.\nsteps are taken from the AWS VPN Guide\nClone the OpenVPN easy-rsa repo to your local computer and navigate to the easy-rsa/easyrsa3 folder. git clone https://github.com/OpenVPN/easy-rsa.git this provides an easy workflow for creating and managing certificates.\nInitialize a new PKI environment. ./easyrsa init-pki To build a new certificate authority (CA), run this command and follow the prompts. ./easyrsa build-ca nopass no pass means you don’t require a passphrase to use that ca-certificate. Basically, you are creating ‘ca-cert’, which will act as the root certificate and ‘private key’ for that certificate.\nGenerate the server certificate and key. ./easyrsa build-server-full server nopass This creates a server certificate and its private key. Here, a certificate gets created, which means it is also signed by the certificate authority by using its private key.\nNow you can optionally generate client certificates. This means that you can generate a separate certificate for each client or use the same for everyone. However, it is recommended that you use a separate certificate for each client, so in the case of that employee leaves your organization, you can simply revoke that certificate, rather than revoking the common one and giving everyone a new cert.\nBut for our usecase one cert is enough. so let’s go ahead and create it.\nGenerate the client certificate and key. ./easyrsa build-client-full client1.domain.tld nopass Copy the server certificate and key and the client certificate and key to a custom folder, and then navigate into the custom folder. mkdir ~/custom_folder/ cp pki/ca.crt ~/custom_folder/ cp pki/issued/server.crt ~/custom_folder/ cp pki/private/server.key ~/custom_folder/ cp pki/issued/client1.domain.tld.crt ~/custom_folder cp pki/private/client1.domain.tld.key ~/custom_folder/ cd ~/custom_folder/ This is to simplify the workflow for uploading these certs to AWS.\nUploading certificates to the AWS Certificate Manager Here, you can either use aws-cli or aws-console to upload the certificates.\nBut we will follow a console-based method for simplicity.\nHead towards AWS Certificate Manager and click import Certificate.\nHere, give the details, like server certificate, Private Key and optionally the certificate chain. But here, you must provide the certificate of CA.\nIf you don’t provide a CA certificate, even in normal cases of simply attaching to a domain, your client browser will request a certificate, and when it gets this, it will try to authorize it with the built-in CA certificates that it trusts. If it doesn’t find any CA certificates that can authorize this server certificate, It fails to authorize it and doesn’t set up TLS.\nBut when you also provide the CA certificate along with the server certificate, the client can authorize it and establish the secure connection, but of course, it will try to back out as the certificate is custom and not globally accredited.\nBut in our case for VPN connections, this is fine and the recommended way of managing certificates.\nSo when the client connects, it will be able to authorize the server using the CA cert and successfully establish a connection to the server via TLS.\nNow, when you provide the CA cert in the certificate chain, of course you have only two hierarchies in the certificate chain: one is the server cert, and the other is the root cert, or CA cert, which actually signs the server cert.\nSo you simply need to give the CA certificate in the certificate chain.\nNow your certificate is imported! Congrats!\nNow you can optionally import the client certificate here. But in our case, it is not required. Why?\nBecause when our VPN service requests that the client bring its own certificate and the client sends it, The VPN service authorizes it on the basis of a certificate chain, right? But if the client doesn’t send the CA cert, then how does this service authorize it? Well, it falls back on using the certificate chain provided by us for the server.\nAnd as we have created the client certificate and signed it using the same CA authority The service will successfully be able to authorize the client certificate.\nBut if you have used different CA, you need to import exactly the same you imported the server cert.\nThis also proves security. why?\nBecause no one can use any certificate other than signed by your CA authority, which is residing in your linux machine!\nSo even if a person has globally accredited certificate for his server, his of-course won’t be able to access our VPN service as the server would fail to authorize it as its certificate is not signed by our CA Authority\nCreating a Client VPN Endpoint This step actually creates a VPN where users can connect.\nHere, go to the Client VPN Endpoints section in the VPC.\nCreate an Endpoint.\nHere, give,\nname for the endpoint (optional) Give the CIDR block from which your clients will get private IP addresses. Don’t give a CIDR block, which can conflict with the subnet that you want to work with. Give server certificate that will be used for a secure connection. Check the mutual authentication box to authorize clients as well. Here for Client Certificate ARN, choose the same server certificate. This makes sure that the VPN service will authorize the clients based on the CA cert of the server itself. i.e it will use the certificate chain of server certificate to authorize the client certificate. If you have used different CA for client certificate, make sure to import that first and choose it. You can optionally set the DNS server to use here. remember there is no default DNS server configured for your VPN, so if you plan to access internet from this, make sure to add DNS server here. Leave everything blank, as we don’t require other things for this demonstration.\nNow you have set up the client VPN. Its now time to give clients access to a particular subnet or subnets.\nTo configure this, simply go to the target network associations\nand then choose Associate target network\nHere, choose the subnet that you want to access from your VPN.\nThere is a route table associated with this VPN, and when you associate the subnet, It automatically creates an entry in the route table.\nHere, you can also add custom route entries, like for accessing the internet.\nBut remember, you can only access the internet with the help of a subnet.\nSo if you have configured the Internet Gateway for that VPC, you can go on the internet from the VPN. when you add 0.0.0.0/0 route in the route table and select the target network as the subnet that has internet access.\nHere, remember that, by-default, VPN configures NAT by which you can reach the internet, so even if the subnet doesn’t have access to the internet, if an internet gateway is there, you can access the internet from the VPN without any extra configuration. That’s great!\nBut small things are remaining that you need to do in order to fully set up your VPN.\nFirst, head towards Authorization Rules and create the rule where all or some of your clients are able to access what they want.\nIf you want to allow all the clients to go wherever they need to go according to the route table, simply Allow them for the 0.0.0.0/0 network.\nThese rules allow you to give fine-grained access to your VPN clients, so even if the route table of the VPN has multiple routes, it is your responsibility to give each client specific access or give all of them full access to all the networks (subnets) that you have associated.\nTesting Now that everything is setup, try creating an EC2 instance in the same region as your VPN and making it private purposefully. Also, make sure to create it in the subnet that you have associated with the VPN.\nNow you can’t access this instance from the internet, right? And before this, there was no way with which you could gain access to this instance, right?\nMeaning if you headed towards Connect and tried connecting, AWS would error out that the instance is private.\nIn order to connect to it, there was only one way there: bastion host, which is again not that secure considering you still require a public endpoint from which you will access private resources.\nBut now, with the Client VPN, you can successfully access the instance as the subnet in which it lies is associated with the VPN.\nSo download the client configuration from the top bar.\nYou get an .ovpn file.\nBefore you start using it, a few changes are required.\nThe changes are because, if you didn’t setup mutual authentication for VPN, you can use this file directly to connect to the VPN.\nBut as you have mutual authentication enabled, you need to provide the certificate path and private key path in this .ovpn file.\nSo before changes, the file looks like this:\nclient dev tun proto udp remote cvpn-endpoint-00e16cdbf058cc151.prod.clientvpn.us-east-1.amazonaws.com 443 remote-random-hostname resolv-retry infinite nobind remote-cert-tls server cipher AES-256-GCM verb 3 -----BEGIN CERTIFICATE----- -----END CERTIFICATE----- reneg-sec 0 verify-x509-name server name Here, you don’t see any configuration for the client certificate or its private key.\nNow, as I previously told you, store all the files in custom_folder, including the client certificate and its private key. Grab their fully qualified path and paste it like this, so the end result is like,\nclient dev tun proto udp remote cvpn-endpoint-00e16cdbf058cc151.prod.clientvpn.us-east-1.amazonaws.com 443 remote-random-hostname resolv-retry infinite nobind remote-cert-tls server cipher AES-256-GCM --cert \"/home/varad/custom_folder/client.domain.tld.crt\" --key \"/home/varad/custom_folder/client.domain.tld.key\" verb 3 -----BEGIN CERTIFICATE----- -----END CERTIFICATE----- reneg-sec 0 verify-x509-name server name See those --cert and --key, and paste your paths in front of them.\nNow when that is done, it’s done!\nYou cannot use the aws-cli for connecting to this VPN.\nSo now head over to the aws vpn client download to download the appropriate client for your system with which you can connect to the VPN you just set up.\nI prefer the windows/macos client as for Linux, you require outdated Linux machines (18.04 \u0026 20.04) and I bet most of you people won’t even have it. And don’t even try to download this client in a suitable Docker container or VM, as this might cause unnecessary troubles. (I tried a lot.)\nSo if you have a Windows client, make sure to change the path in the certificate accordingly and have double backslashes instead of singles in the path.\nNow, after all this, you can now successfully connect to the VPN!\n","wordCount":"2430","inLanguage":"en","datePublished":"2023-12-12T09:15:19+05:30","dateModified":"2023-12-18T13:31:04+05:30","author":{"@type":"Person","name":"Varad Belwalkar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://belwalkarvarad.tech/posts/vpn-workflow-aws/"},"publisher":{"@type":"Person","name":"Varad Belwalkar","logo":{"@type":"ImageObject","url":"https://belwalkarvarad.tech/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://belwalkarvarad.tech/ accesskey=h title="Varad Belwalkar (Alt + H)">Varad Belwalkar</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://belwalkarvarad.tech/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://belwalkarvarad.tech/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://belwalkarvarad.tech/dailies/ title="Daily Logs"><span>Daily Logs</span></a></li><li><a href=https://belwalkarvarad.tech/about/ title=About><span>About</span></a></li><li><a href=https://belwalkarvarad.tech/subscribe/ title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://belwalkarvarad.tech/>Home</a>&nbsp;»&nbsp;<a href=https://belwalkarvarad.tech/posts/>Posts</a></div><h1 class=post-title>How to actually setup VPN in AWS?</h1><div class=post-meta>[December 12, 2023 12 min]&nbsp;|&nbsp;<a href=https://github.com/VaradBelwalkar/posts/vpn-workflow-aws.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on x" href="https://x.com/intent/tweet/?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&amp;hashtags=AWS%2cVPN"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&amp;title=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;summary=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;source=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&title=How%20to%20actually%20setup%20VPN%20in%20AWS%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f%20-%20https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on telegram" href="https://telegram.me/share/url?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div><div class=post-content><h2 id=what-is-a-vpn-in-the-first-place>What is a VPN in the first place?<a hidden class=anchor aria-hidden=true href=#what-is-a-vpn-in-the-first-place>#</a></h2><p>VPN is what it says: Virtual Private Network.
<strong>but what does that exactly mean?</strong></p><p>Suppose you are using an internet connection available at your university and connecting to the internet.
In this case, the university has a private network setup that allows you to access the internet, but here,
You can definitely get traced because, well, ultimately, the traffic will be coming and going to your
university&rsquo;s main router, and of course, the ISP has records for that.
and your university might as well keep records of what you are visiting through a firewall, which is a common scenario.</p><p>But with the VPN, you can get into a private network, but in this case, it is virtual in some
other geographical region, which keeps your identity private (mostly!)
Here, it is very hard to trace your identity and what you have visited when you are visiting a VPN.</p><p>If you are accessing a VPN at your university, the university will find a normal valid IP address that you are visiting, but mostly it doesn&rsquo;t know it is a VPN and has no control over what you are accessing or how you are accessing it.</p><p>It is like you are virtually in that private network, i.e., your PC or laptop is in the private network, which is on some server that you don&rsquo;t handle.</p><p>Fine, now that you understand how VPN works, let&rsquo;s understand how AWS allows you to create a VPN and let you connect to it.</p><hr><p>When creating a VPN in AWS, you can do the following:</p><ul><li>access private resources not routable on the internet. e.g., not having public IP.</li><li>access internet securely to access some content that is restricted to your geographical location.</li><li>have controlled connectivity for VPN clients to be able to access the internet.</li><li>Only allow connectivity from your VPN for a particular resource and not from the internet, though the resources are publicly available. e.g., having administrative privileges work only when admins are connected via VPN and not exposing the admin API over the internet.</li><li>etc.</li></ul><p>There are more use cases, of course, than this. But you get the point.</p><hr><h3 id=well-lets-dive-deep-into-how-everything-fits-together>Well, let&rsquo;s dive deep into how everything fits together.<a hidden class=anchor aria-hidden=true href=#well-lets-dive-deep-into-how-everything-fits-together>#</a></h3><p>When you need to create a VPN, what you are basically doing is creating a VPN service, which will
let users connect to it.
you can,</p><ul><li>restrict which users can access the VPN using mutual authentication.</li><li>restrict users over subnets and internet connectivity.</li></ul><p>VPN is, of course, over HTTPS, so who is going to provide the secure connection?</p><p>VPN is a kind of lightweight service that listens to client connection requests and, based on the required authentication, lets users connect to it.</p><p>But to provide a secure connection, you need an SSL certificate, right?</p><p>You can request a certificate from the AWS certificate manager, but wait, should you do it?</p><p>Requesting a certificate from the AWS Cert Manager will authorize a certificate for a domain.
Supposing you have bought the <code>example.com</code> domain, setup static hosting on the S3 bucket, and want to secure your client connections, you request a certificate from Cert Manager.
where you <strong>prove</strong> your domain ownership.
So then you can use that certificate in CloudFront to secure your domain.</p><p>But here is the catch: your clients can get the secure connection when they connect to your domain, which you have validated when requesting the certificate, right?</p><p>But when you create a VPN client in AWS that has a different endpoint, something like,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>cvpn-endpoint-06cfc1ca6ccea985c.prod.clientvpn.us-east-1.amazonaws.com
</span></span></code></pre></div><p>This is the endpoint that I got when I created a client VPN.</p><p>So, how do you handle this domain?
Is there any point in requesting a certificate from AWS for this domain?
Of course not!</p><p>What you simply need to do is create a custom certificate and sign it with a certificate authority of your own!</p><h3 id=create-client-and-server-certificates-on-your-linux-machine>Create client and server certificates on your Linux machine.<a hidden class=anchor aria-hidden=true href=#create-client-and-server-certificates-on-your-linux-machine>#</a></h3><p>To create client and server certificates, you must have a certificate authority that signs those certificates, right?</p><blockquote><p>Here understand that we need to have <strong>mutual authentication</strong>, meaning we also need to authorize the clients that are connecting to the VPN and allow only them to connect.</p></blockquote><blockquote><p>steps are taken from the <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/mutual.html?utm_source=varad_blog&amp;utm_medium=referral&amp;utm_campaign=how-to-actually-setup-vpn-in-aws" target=_blank>AWS VPN Guide</a></p></blockquote><ol><li>Clone the OpenVPN easy-rsa repo to your local computer and navigate to the easy-rsa/easyrsa3 folder.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/OpenVPN/easy-rsa.git
</span></span></code></pre></div><blockquote><p>this provides an easy workflow for creating and managing certificates.</p></blockquote><ol start=2><li>Initialize a new PKI environment.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./easyrsa init-pki
</span></span></code></pre></div><ol start=3><li>To build a new <strong>certificate authority (CA)</strong>, run this command and follow the prompts.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./easyrsa build-ca nopass
</span></span></code></pre></div><blockquote><p>no pass means you don&rsquo;t require a passphrase to use that ca-certificate.
Basically, you are creating &lsquo;ca-cert&rsquo;, which will act as the root certificate and &lsquo;private key&rsquo; for that certificate.</p></blockquote><ol start=4><li>Generate the server certificate and key.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./easyrsa build-server-full server nopass
</span></span></code></pre></div><blockquote><p>This creates a server certificate and its private key. Here, a certificate gets created, which means it is also signed by the certificate authority by using its private key.</p></blockquote><p>Now you can optionally generate client certificates.
This means that you can generate a separate certificate for each client or use the same for everyone.
However, it is recommended that you use a separate certificate for each client, so in the case of that employee
leaves your organization, you can simply revoke that certificate, rather than revoking the common one and giving everyone a new cert.</p><p>But for our usecase one cert is enough. so let&rsquo;s go ahead and create it.</p><ol start=5><li>Generate the client certificate and key.</li></ol><pre tabindex=0><code>./easyrsa build-client-full client1.domain.tld nopass
</code></pre><ol start=6><li>Copy the server certificate and key and the client certificate and key to a custom folder, and then navigate into the custom folder.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir ~/custom_folder/
</span></span><span style=display:flex><span>cp pki/ca.crt ~/custom_folder/
</span></span><span style=display:flex><span>cp pki/issued/server.crt ~/custom_folder/
</span></span><span style=display:flex><span>cp pki/private/server.key ~/custom_folder/
</span></span><span style=display:flex><span>cp pki/issued/client1.domain.tld.crt ~/custom_folder
</span></span><span style=display:flex><span>cp pki/private/client1.domain.tld.key ~/custom_folder/
</span></span><span style=display:flex><span>cd ~/custom_folder/
</span></span></code></pre></div><p>This is to simplify the workflow for uploading these certs to AWS.</p><hr><h3 id=uploading-certificates-to-the-aws-certificate-manager>Uploading certificates to the AWS Certificate Manager<a hidden class=anchor aria-hidden=true href=#uploading-certificates-to-the-aws-certificate-manager>#</a></h3><p>Here, you can either use <code>aws-cli</code> or aws-console to upload the certificates.</p><p>But we will follow a console-based method for simplicity.</p><p>Head towards <strong>AWS Certificate Manager</strong> and click <strong>import Certificate</strong>.</p><figure class=align-center><a href=/images/VPN-AWS/certimport.png target=_blank><img loading=lazy src=/images/VPN-AWS/certimport.png#center></a></figure><p>Here, give the details, like <strong>server certificate</strong>, <strong>Private Key</strong> and optionally the certificate chain.
But here, you must provide the certificate of CA.</p><p>If you don&rsquo;t provide a CA certificate, even in normal cases of simply attaching to a domain, your client browser will request a certificate, and when it gets this, it will try to authorize it with the built-in CA certificates that it trusts. If it doesn&rsquo;t find any CA certificates that can authorize this server certificate,
It fails to authorize it and doesn&rsquo;t set up TLS.</p><p>But when you also provide the CA certificate along with the server certificate, the client can authorize it and establish the secure connection, but of course, it will try to back out as the certificate is custom and not globally accredited.</p><p>But in our case for VPN connections, this is fine and the recommended way of managing certificates.</p><p>So when the client connects, it will be able to authorize the server using the CA cert and successfully establish a connection to the server via <strong>TLS</strong>.</p><p>Now, when you provide the CA cert in the certificate chain, of course you have only two hierarchies in the certificate chain: one is the server cert, and the other is the root cert, or CA cert, which actually signs the server cert.</p><p>So you simply need to give the CA certificate in the certificate chain.</p><p>Now your certificate is imported! Congrats!</p><hr><p>Now you can optionally import the client certificate here.
But in our case, it is <strong>not required</strong>.
Why?</p><p>Because when our VPN service requests that the client bring its own certificate and the client sends it,
The VPN service authorizes it on the basis of a certificate chain, right?
But if the client doesn&rsquo;t send the CA cert, then how does this service authorize it?
Well, it falls back on using the certificate chain provided by us for the server.</p><p>And as we have created the client certificate and signed it using the same <strong>CA authority</strong>
The service will successfully be able to authorize the client certificate.</p><p>But if you have used different <strong>CA</strong>, you need to import exactly the same you imported the server cert.</p><p>This also proves security. why?</p><p>Because <strong>no one</strong> can use any certificate other than signed by your <strong>CA authority</strong>, which is residing in your linux machine!</p><p>So even if a person has globally accredited certificate for his server, his of-course won&rsquo;t be able to access our VPN service as the server would fail to authorize it as its certificate is not signed by our <strong>CA Authority</strong></p><hr><h3 id=creating-a-client-vpn-endpoint>Creating a Client VPN Endpoint<a hidden class=anchor aria-hidden=true href=#creating-a-client-vpn-endpoint>#</a></h3><p>This step actually creates a VPN where users can connect.</p><p>Here, go to the <strong>Client VPN Endpoints</strong> section in the VPC.</p><figure class=align-center><a href=/images/VPN-AWS/vpnendpoint.png target=_blank><img loading=lazy src=/images/VPN-AWS/vpnendpoint.png#center></a></figure><p>Create an Endpoint.</p><p>Here, give,</p><ul><li>name for the endpoint (optional)</li><li>Give the CIDR block from which your clients will get private IP addresses.
Don&rsquo;t give a CIDR block, which can conflict with the subnet that you want to work with.</li><li>Give server certificate that will be used for a secure connection.</li><li>Check the mutual authentication box to authorize clients as well.
Here for <code>Client Certificate ARN</code>, choose the same server certificate.
This makes sure that the VPN service will authorize the clients based on the CA cert of the server itself. i.e it will use the certificate chain of server certificate to authorize the client certificate. If you have used different <code>CA</code> for client certificate, make sure to import that first and choose it.</li><li>You can optionally set the DNS server to use here. remember there is no default DNS server configured for your VPN, so if you plan to access internet from this, make sure to add DNS server here.</li></ul><p>Leave everything blank, as we don&rsquo;t require other things for this demonstration.</p><p>Now you have set up the client VPN.
Its now time to give clients access to a particular <strong>subnet</strong> or <strong>subnets</strong>.</p><p>To configure this, simply go to the <strong>target network associations</strong></p><p>and then choose <strong>Associate target network</strong></p><figure class=align-center><a href=/images/VPN-AWS/network-association.png target=_blank><img loading=lazy src=/images/VPN-AWS/network-association.png#center></a></figure><p>Here, choose the subnet that you want to access from your VPN.</p><p>There is a <strong>route table</strong> associated with this VPN, and when you associate the subnet,
It automatically creates an entry in the route table.</p><figure class=align-center><a href=/images/VPN-AWS/vpn-route-table.png target=_blank><img loading=lazy src=/images/VPN-AWS/vpn-route-table.png#center></a></figure><p>Here, you can also add custom route entries, like for accessing the internet.</p><p>But remember, you can only access the internet with the help of a subnet.</p><p>So if you have configured the Internet Gateway for that VPC, you can go on the internet from the VPN.
when you add <code>0.0.0.0/0</code> route in the route table and select the <code>target network</code> as the subnet that has internet access.</p><p>Here, remember that, <strong>by-default</strong>, VPN configures NAT by which you can reach the internet, so even if the subnet doesn&rsquo;t have access to the internet, if an internet gateway is there, you can access the internet from the VPN without any extra configuration. That&rsquo;s great!</p><p>But small things are remaining that you need to do in order to fully set up your VPN.</p><p>First, head towards <strong>Authorization Rules</strong> and create the rule where all or some of your clients are able to access what they want.</p><p>If you want to allow all the clients to go wherever they need to go according to the route table, simply
Allow them for the <code>0.0.0.0/0</code> network.</p><p>These rules allow you to give fine-grained access to your VPN clients, so even if the route table of the VPN has multiple routes, it is your responsibility to give each client specific access or give all of them full access to all the networks (subnets) that you have associated.</p><hr><h3 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h3><p>Now that everything is setup, try creating an <strong>EC2 instance</strong> in the same region as your VPN and making it private purposefully.
Also, make sure to create it in the subnet that you have associated with the VPN.</p><p>Now you can&rsquo;t access this instance from the internet, right?
And before this, there was no way with which you could gain access to this instance, right?</p><p>Meaning if you headed towards Connect and tried connecting, AWS would error out that the instance is private.</p><p>In order to connect to it, there was only one way there: <strong>bastion host</strong>, which is again not that secure considering you still require a public endpoint from which you will access private resources.</p><p>But now, with the <strong>Client VPN</strong>, you can successfully access the instance as the subnet in which it lies is associated with the VPN.</p><p>So download the client configuration from the top bar.</p><p>You get an <code>.ovpn</code> file.</p><p>Before you start using it, a few changes are required.</p><p>The changes are because, if you didn&rsquo;t setup <strong>mutual authentication</strong> for VPN, you can use this file directly to connect to the VPN.</p><p>But as you have <strong>mutual authentication</strong> enabled, you need to provide the <strong>certificate path</strong> and <strong>private key</strong> path in this <code>.ovpn</code> file.</p><p>So before changes, the file looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>client
</span></span><span style=display:flex><span>dev tun
</span></span><span style=display:flex><span>proto udp
</span></span><span style=display:flex><span>remote cvpn-endpoint-00e16cdbf058cc151.prod.clientvpn.us-east-1.amazonaws.com 443
</span></span><span style=display:flex><span>remote-random-hostname
</span></span><span style=display:flex><span>resolv-retry infinite
</span></span><span style=display:flex><span>nobind
</span></span><span style=display:flex><span>remote-cert-tls server
</span></span><span style=display:flex><span>cipher AES-256-GCM
</span></span><span style=display:flex><span>verb 3
</span></span><span style=display:flex><span>&lt;ca&gt;
</span></span><span style=display:flex><span>-----BEGIN CERTIFICATE-----
</span></span><span style=display:flex><span>&lt;the certificate here&gt;
</span></span><span style=display:flex><span>-----END CERTIFICATE-----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/ca&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reneg-sec 0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>verify-x509-name server name
</span></span></code></pre></div><p>Here, you don&rsquo;t see any configuration for the client certificate or its private key.</p><p>Now, as I previously told you, store all the files in <code>custom_folder</code>, including the client certificate and its private key.
Grab their fully qualified path and paste it like this, so the end result is like,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>client
</span></span><span style=display:flex><span>dev tun
</span></span><span style=display:flex><span>proto udp
</span></span><span style=display:flex><span>remote cvpn-endpoint-00e16cdbf058cc151.prod.clientvpn.us-east-1.amazonaws.com 443
</span></span><span style=display:flex><span>remote-random-hostname
</span></span><span style=display:flex><span>resolv-retry infinite
</span></span><span style=display:flex><span>nobind
</span></span><span style=display:flex><span>remote-cert-tls server
</span></span><span style=display:flex><span>cipher AES-256-GCM
</span></span><span style=display:flex><span>--cert &#34;/home/varad/custom_folder/client.domain.tld.crt&#34;
</span></span><span style=display:flex><span>--key &#34;/home/varad/custom_folder/client.domain.tld.key&#34;
</span></span><span style=display:flex><span>verb 3
</span></span><span style=display:flex><span>&lt;ca&gt;
</span></span><span style=display:flex><span>-----BEGIN CERTIFICATE-----
</span></span><span style=display:flex><span>&lt;the certificate here&gt;
</span></span><span style=display:flex><span>-----END CERTIFICATE-----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/ca&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reneg-sec 0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>verify-x509-name server name
</span></span></code></pre></div><p>See those <code>--cert</code> and <code>--key</code>, and paste your paths in front of them.</p><p>Now when that is done, it&rsquo;s done!</p><p>You <strong>cannot</strong> use the aws-cli for connecting to this VPN.</p><p>So now head over to the <a href>aws vpn client download</a>
to download the appropriate client for your system with which you can connect to the VPN you just set up.</p><p>I prefer the <strong>windows/macos client</strong> as for Linux, you require outdated Linux machines (18.04 & 20.04) and I bet most of you people won&rsquo;t even have it.
And don&rsquo;t even try to download this client in a suitable Docker container or VM, as this might cause unnecessary troubles. (I tried a lot.)</p><p>So if you have a Windows client, make sure to change the path in the certificate accordingly and have double backslashes instead of singles in the path.</p><p>Now, after all this, you can now successfully connect to the VPN!</p><h2>Related Posts</h2><ul><li><a href=/posts/s3-bucket-aws-overview/>An overview of S3 bucket in AWS</a></li><li><a href=/posts/aws-route53-overview/>An overview of AWS Route53</a></li><li><a href=/posts/peering-connection-in-aws/>What is Peering Connections in AWS?</a></li></ul><section class=subscribe-content><hr><p>Thank you for reading <i>"How to actually setup VPN in AWS?."</i></p><p>Subscribe via <a href=/subscribe>email</a> or
<a href=/index.xml target=_blank>RSS feed</a> to be the first to receive
my content.</p><p>If you liked this post, check out my <a href=/categories/featured>featured posts</a> or learn more <a href=/about>about me</a>.</p></section><section class=subscription-form><form method=post autocomplete=off class=subscribe-form><div class=subscribe-input><input type=email name=EMAIL id=email required placeholder="Email Address ↵" title="Email Address"></div><input value=Subscribe type=submit class=subscribe-button title=Subscribe></form><section class=entry-content><div class=subscribe-message>Get a bimonthly dose of tech news, curated content, and uninterrupted musings.</div></section></section><script>$(".subscribe-form").submit(function(e){e.preventDefault();var t=$(this),n=t.attr("action"),s=t.attr("method");$.ajax({type:s,url:n,data:t.serialize(),dataType:`jsonp`,success:function(e){e.result===`success`?(t.find(".subscribe-button").attr("value","Subscribed!"),$(".subscribe-message").html("Thank you for subscribing! Check your inbox and add me in your contacts to not miss an issue!"),$(".subscribe-form :input").prop("disabled",!0)):(t.find(".subscribe-button").attr("value","Failed to Subscribe! Click again to retry"),$(".subscribe-message").html("There was an error subscribing you to my blog. "+e.msg+"."),t[0].reset()),console.log(e)},error:function(e){console.log("An error occurred."),console.log(e),t[0].reset()}})})</script></div><footer class=post-footer><ul class=post-tags><li><a href=https://belwalkarvarad.tech/tags/aws/>AWS</a></li><li><a href=https://belwalkarvarad.tech/tags/vpn/>VPN</a></li></ul><nav class=paginav><a class=next href=https://belwalkarvarad.tech/posts/s3-bucket-aws-overview/><span class=title>Next »</span><br><span>An overview of S3 bucket in AWS</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on x" href="https://x.com/intent/tweet/?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&amp;hashtags=AWS%2cVPN"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&amp;title=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;summary=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;source=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f&title=How%20to%20actually%20setup%20VPN%20in%20AWS%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f%20-%20https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on telegram" href="https://telegram.me/share/url?text=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to actually setup VPN in AWS? on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20to%20actually%20setup%20VPN%20in%20AWS%3f&u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fvpn-workflow-aws%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>This work by <a href=https://belwalkarvarad.tech/about/#about-me>Varad Belwalkar</a></span>
<span>is licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>for(var els=document.getElementsByClassName("highlight"),title,code,newNode,i=0;i<els.length;i++)title=els[i].title,code=els[i].firstElementChild.firstElementChild,title.length&&(newNode=document.createElement("div"),newNode.textContent=title,newNode.classList.add("highlight-title"),code.parentNode.insertBefore(newNode,code))</script></body></html>