<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How does NAT work? | Varad Belwalkar</title>
<meta name=keywords content="Networking,NAT"><meta name=description content="NAT behind the scenes"><meta name=author content="Varad Belwalkar"><link rel=canonical href=https://belwalkarvarad.tech/posts/nat-overview/><script defer data-domain=belwalkarvarad.tech src=/misc/js/script.js data-api=/misc/api/event></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><script></script><link crossorigin=anonymous href=/assets/css/stylesheet.4f6c284a5168491e386e284261babc93d54f28c24f58b131800365a8fa5995e3.css integrity="sha256-T2woSlFoSR44bihCYbq8k9VPKMJPWLExgANlqPpZleM=" rel="preload stylesheet" as=style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://belwalkarvarad.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://belwalkarvarad.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://belwalkarvarad.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://belwalkarvarad.tech/apple-touch-icon.png><link rel=mask-icon href=https://belwalkarvarad.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="How does NAT work?"><meta property="og:description" content="NAT behind the scenes"><meta property="og:type" content="article"><meta property="og:url" content="https://belwalkarvarad.tech/posts/nat-overview/"><meta property="og:image" content="https://belwalkarvarad.tech/images/preview.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-10T09:15:19+05:30"><meta property="article:modified_time" content="2023-12-14T14:50:28+05:30"><meta property="og:site_name" content="Varad Belwalkar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://belwalkarvarad.tech/images/preview.png"><meta name=twitter:title content="How does NAT work?"><meta name=twitter:description content="NAT behind the scenes"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://belwalkarvarad.tech/posts/"},{"@type":"ListItem","position":2,"name":"How does NAT work?","item":"https://belwalkarvarad.tech/posts/nat-overview/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How does NAT work?","name":"How does NAT work?","description":"NAT behind the scenes","keywords":["Networking","NAT"],"articleBody":"NAT is by far the most used technology to provide internet access to the public.\nYou might be knowing that Internet Service Providers such as Airtel, AT\u0026T are providing their customers internet through their cellular network infrastructure,\nYes, you heard it right, this was and is the major advantage for them as they can establish both cellular network and internetwork on the same tower which they own, this makes them simplify the implementation of routers which can then provide internet to the public in that region\nBut how does this work?\nYou might be knowing that the private ip ranges are,\n10.0.0.0/8 172.16.0.0/14 this means from 172.16.0.0 to 172.31.255.255 192.168.0.0/16 But what does this mean?\nWell this means that NO RIR i.e Regional Internet Registry NOR the IANA i.e Internet Number Authority can assign or give any ip or network from these ranges to any organisation or to anyone, This means no organisation or anything in the world will own any ip or a network from these ranges as their public endpoint\nBut, understand that we as human beings have assigned these ranges as private ones, the core routers and the provider edge routers don’t understand that unless configured specifically, right,\nHere, if any core router or provider edge router has an entry in the routing table for any ip or network from this range, the interface on which the packet has to sent to, must either belong to that network itself, or must be performing subnetting on that network, or you may say that it should be provider edge router outgrowing in that network through the interface which is listed in the routing table.\ndon’t consider this as of now,\nwell you know that these are private ranges and most importantly used to just access internet and let me clear, they are not used to provide any service to the outside world, remember i am not talking about any special cases like port forwarding or tunneling, in standared scenario, they are just used to provide internet access to internal network.\nSo what does NAT do?\nIt simply makes request on behalf of you and gets the response back to you, yes that is simple!\nYour ISP makes a private network (mostly, but just focus here) in one of these range, and runs DHCP service on its end, and when you on you internet, you get connectivity right?\nYes, but where is you ethernet port ?\nhow are you even connecting with that router?\nWell, in case of wireless networks, you have virtual interfaces through which you connect, and you smart phone will have one, yes only one, that is why you can either turn network connectivity of airtel or jio, not both right?\nSo this one virtual interface gets the DHCP allocated ip address within a private range, and gets the other network info such as gateway ip, lease time and so on.\nRemember that the interface to which your mobile phone is connected is again the virtual interface of that router, and here, as in physical we require switches, here no switches are required as everything is software based or in the control plane itself.\nHere, switch you may say is nothing but a collection of mappings of which frequency we need to accept and send packets to a particular endpoint and the endpoint itself\nHere, you smartphone also has routing table, now understand, every computer has a routing table,\nwhen you make a request to ip suppose 120.0.2.2/24 Here, you phone doesn’t have any routing information in routing table about this network right, i.e about 120.0.2.0/24, So if the phone doesn’t know where to send, it sends to the default gateway,\nwith source ip lets say 192.168.2.2 and dest ip of that gateway 192.168.1.1, with source port 51k and dest port 80\nnow when this request comes to the router, the router knows that it has performed NAT (I WILL EXPLAIN HOW IT KNOWS LATER) on this particular interface, so what router does, as it is a provider edge router, it will definitely will be running a BGP protocol with which it can find the next hop for the networks, so when this packet comes on it, it first finds the network to which it belongs and sees if there is any entry in that BGP table or routing table you may say, once it gets the next hop and the ip of next hop, it simply gets a free port from his pool of ports lets say 40k and makes an entry in the NAT table like following (not exactly)\nsource IP Dest IP sourceport destport allo.port 192.168.2.2 120.0.2.2 51k 80 40k this entry persists until it becomes inactive(will discuss later),\nSo what router does, it simply replaces the source ip with the ip address of the interface from which it needs to forward the packet to the next hop, always remember the ip address of that interface only from which it is going to send it to next hop, and the source port to 40k and finally sends it.\nonce it gets the response packet, what does that packet has? it has source ip 120.0.2.2, source port 80, dest ip 29.20.2.4, dest port 40k\nHere the router gets this packet from that interface which is having ip 29.20.2.4, so first time, router might think that this packet is for itself, so there are configuration dependancies whether router will take time to check whether any of its services is listening on the port 40k (which obviously not at all possible) or directly go to NAT table when it finds a packet dedicated for it,\ni think the second case would be true, so any way, when the router sees in the NAT table, if there is not entry according to the dest port of the packet, it discards the packet, yes it discards, and you may say that the indexing of this table is done on the basis of allocated port so if router finds and entry,\nif checks whether the packet is following everything or not, i.e it is coming from the intended destination, the port is correct, and so on, once it is checked, the router simply changes the destination ip to 192.168.2.2 here, and also the destination port to 51k as before, and then it checks in the routing table where to send that packet to, so it finds the interface to which it needs to send,\nhere, if in the routing table, the entry is there for the network which here is indeed private and there is shown the interface to which the packet needs to be sent from, if the next hop ip is MISSING or NULL, i am repeating again, if the NEXT HOP ip is MISSING or NULL, then router checks whether the interface is in the same network or not, and here, the interface is indeed in the same network, so router now checks whether there is any entry for the MAC address for that ip address in its ARP table, if not, it gets from ARP resolution,\nonce get it simply transmitts through that interface meaning it will directly reach to the host and may be throug switches.\nbut if there is subnetting performed, then there will be next hop located in the routing table, and it needs to simply pass on to them,\nnow the routers which are actually part of the complete usable subnet, there will be an empty entry in the next hop, meaning that it has to send directly to the host.\nand yes, in this way the request and response are successful\nhere, the default side effect of this is one cannot from outside can connect to the internal network or hosts directly, as it is obviously not possible, because it seems non-logical that how can outsider can generate such a packet that can go inside, the only possible way is to have session established already i.e in the NAT table there should be entry and only traffic from that server will get through.\nAlso some ISP don’t care about these ranges even, in fact, my mobile has got ip address 25.23.14.187 from jio ISP, which means that it really doesn’t matter at the router end, why?\nWell, suppose this network is /24, and the interface to which i am connected to i.e gateway is 25.23.14.1/24, now when the router performs NAT and is going to send the packet to the outside, it is going to add the source IP of the interface from which it is going to forward the packet to the next hop, according to NAT policy, and once the response comes it is for the same router i.e with the ip address of that interface, then router first may check if any service wants that packet which is listening on its os, if not, then it will check the NAT table, and there will be the entry then, and according to that entry, it has to send the packet to the interface with ip 25.23.14.1, and if subnetting done, then next hop else NULL, you got the point,\nbut here, don’t you think that this is a provider edge router and it also might have entry for the same network for some real world organisation?\nYes, of course, but you need to understand that this is typically done on the routers which are not performing any BGP and so, meaning they do have4 publicly routable ip addresses for some of their interfaces, but not necessarily they participate in routing, i.e they are specifying the default route for to the other routers to send the packets and those routers when got the response, can definitely send it back towards this router, where, NAT is performed and that 25. something network has opening from that interface, so that router doesn’t have to go to the its gatway or default route again!\nSo, the concept of gateway or default route is not just used in the private network but also in such scenarios, but yes, this is technique used by ISPs today by allocating single public ip address to their such routers and configuring default route to their main routers which actually participate in BGP topology to exchange routing tables and so on.\n","wordCount":"1712","inLanguage":"en","datePublished":"2023-02-10T09:15:19+05:30","dateModified":"2023-12-14T14:50:28+05:30","author":{"@type":"Person","name":"Varad Belwalkar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://belwalkarvarad.tech/posts/nat-overview/"},"publisher":{"@type":"Person","name":"Varad Belwalkar","logo":{"@type":"ImageObject","url":"https://belwalkarvarad.tech/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://belwalkarvarad.tech/ accesskey=h title="Varad Belwalkar (Alt + H)">Varad Belwalkar</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://belwalkarvarad.tech/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://belwalkarvarad.tech/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://belwalkarvarad.tech/dailies/ title="Daily Logs"><span>Daily Logs</span></a></li><li><a href=https://belwalkarvarad.tech/about/ title=About><span>About</span></a></li><li><a href=https://belwalkarvarad.tech/subscribe/ title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://belwalkarvarad.tech/>Home</a>&nbsp;»&nbsp;<a href=https://belwalkarvarad.tech/posts/>Posts</a></div><h1 class=post-title>How does NAT work?</h1><div class=post-meta>[February 10, 2023 9 min]&nbsp;|&nbsp;<a href=https://github.com/VaradBelwalkar/posts/nat-overview.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on x" href="https://x.com/intent/tweet/?text=How%20does%20NAT%20work%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&amp;hashtags=Networking%2cNAT"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&amp;title=How%20does%20NAT%20work%3f&amp;summary=How%20does%20NAT%20work%3f&amp;source=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&title=How%20does%20NAT%20work%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on whatsapp" href="https://api.whatsapp.com/send?text=How%20does%20NAT%20work%3f%20-%20https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on telegram" href="https://telegram.me/share/url?text=How%20does%20NAT%20work%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20does%20NAT%20work%3f&u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div><div class=post-content><p>NAT is by far the most used technology to provide internet access to the public.</p><p>You might be knowing that Internet Service Providers such as Airtel, AT&amp;T are providing their customers internet through their cellular network
infrastructure,</p><p>Yes, you heard it right, this was and is the major advantage for them as they can establish both cellular network and internetwork on the same
tower which they own, this makes them simplify the implementation of routers which can then provide internet to the public in that region</p><p>But how does this work?</p><p>You might be knowing that the private ip ranges are,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>10.0.0.0/8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>172.16.0.0/14       this means from 172.16.0.0   to   172.31.255.255
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>192.168.0.0/16
</span></span></code></pre></div><p>But what does this mean?</p><p>Well this means that NO RIR i.e Regional Internet Registry NOR the IANA i.e Internet Number Authority can assign or give any ip or network from
these ranges to any organisation or to anyone,
This means no organisation or anything in the world will own any ip or a network from these ranges as their public endpoint</p><p>But, understand that we as human beings have assigned these ranges as private ones, the core routers and the provider edge routers
don&rsquo;t understand that unless configured specifically, right,</p><p>Here, if any core router or provider edge router has an entry in the routing table for any ip or network from this range,
the interface on which the packet has to sent to, must either belong to that network itself, or must be performing subnetting on that network,
or you may say that it should be provider edge router outgrowing in that network through the interface which is listed in the routing table.</p><p>don&rsquo;t consider this as of now,</p><p>well you know that these are private ranges and most importantly used to just access internet and let me clear,
they are not used to provide any service to the outside world, remember i am not talking about any special cases like port forwarding or tunneling,
in standared scenario, they are just used to provide internet access to internal network.</p><p>So what does NAT do?</p><p>It simply makes request on behalf of you and gets the response back to you, yes that is simple!</p><p>Your ISP makes a private network (mostly, but just focus here) in one of these range, and runs DHCP service on its end,
and when you on you internet, you get connectivity right?</p><p>Yes, but where is you ethernet port ?</p><p>how are you even connecting with that router?</p><p>Well, in case of wireless networks, you have virtual interfaces through which you connect, and you smart phone will have one, yes only one,
that is why you can either turn network connectivity of airtel or jio, not both right?</p><p>So this one virtual interface gets the DHCP allocated ip address within a private range, and gets the other network info such as gateway ip,
lease time and so on.</p><p>Remember that the interface to which your mobile phone is connected is again the virtual interface of that router,
and here, as in physical we require switches, here no switches are required as everything is software based or in the control plane itself.</p><p>Here, switch you may say is nothing but a collection of mappings of which frequency we need to accept and send packets to a particular endpoint
and the endpoint itself</p><p>Here, you smartphone also has routing table, now understand, every computer has a routing table,</p><p>when you make a request to ip suppose <code>120.0.2.2/24</code>
Here, you phone doesn&rsquo;t have any routing information in routing table about this network right, i.e about <code>120.0.2.0/24</code>,
So if the phone doesn&rsquo;t know where to send, it sends to the default gateway,</p><p>with source ip lets say <code>192.168.2.2</code> and dest ip of that gateway <code>192.168.1.1</code>,
with source port <code>51k</code> and dest port <code>80</code></p><p>now when this request comes to the router, the router knows that it has performed NAT (I WILL EXPLAIN HOW IT KNOWS LATER)
on this particular interface, so what router does, as it is a provider edge router, it will definitely will be running a BGP protocol
with which it can find the next hop for the networks,
so when this packet comes on it, it first finds the network to which it belongs and sees if there is any entry in that BGP table or routing table
you may say,
once it gets the next hop and the ip of next hop,
it simply gets a free port from his pool of ports lets say 40k and makes an entry in the NAT table like following (not exactly)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>source IP      Dest IP     sourceport      destport       allo.port
</span></span><span style=display:flex><span>192.168.2.2     120.0.2.2      51k            <span style=color:#ae81ff>80</span>               40k
</span></span></code></pre></div><p>this entry persists until it becomes inactive(will discuss later),</p><p>So what router does, it simply replaces the source ip with the ip address of the interface from which it needs to forward the packet to the
next hop, always remember the ip address of that interface only from which it is going to send it to next hop,
and the source port to 40k and finally sends it.</p><p>once it gets the response packet, what does that packet has?
it has source ip <code>120.0.2.2</code>, source port <code>80</code>,
dest ip <code>29.20.2.4</code>, dest port <code>40k</code></p><p>Here the router gets this packet from that interface which is having ip <code>29.20.2.4</code>,
so first time, router might think that this packet is for itself, so there are configuration dependancies whether router will take time to check
whether any of its services is listening on the port 40k (which obviously not at all possible) or directly go to NAT table when it finds a packet
dedicated for it,</p><p>i think the second case would be true, so any way, when the router sees in the NAT table, if there is not entry according to the dest port of
the packet, it discards the packet, yes it discards, and you may say that the indexing of this table is done on the basis of allocated port
so if router finds and entry,</p><p>if checks whether the packet is following everything or not, i.e it is coming from the intended destination, the port is correct,
and so on, once it is checked, the router simply changes the destination ip to <code>192.168.2.2</code> here, and also the destination port to 51k as before,
and then it checks in the routing table where to send that packet to, so it finds the interface to which it needs to send,</p><p>here, if in the routing table, the entry is there for the network which here is indeed private and there is shown the interface to which the packet
needs to be sent from, if the next hop ip is MISSING or NULL, i am repeating again, if the NEXT HOP ip is MISSING or NULL, then router checks whether
the interface is in the same network or not, and here, the interface is indeed in the same network, so router now checks whether there is any
entry for the MAC address for that ip address in its ARP table, if not, it gets from ARP resolution,</p><p>once get it simply transmitts through that interface meaning it will directly reach to the host and may be throug switches.</p><p>but if there is subnetting performed, then there will be next hop located in the routing table, and it needs to simply pass on to them,</p><p>now the routers which are actually part of the complete usable subnet, there will be an empty entry in the next hop, meaning that it has to send
directly to the host.</p><p>and yes, in this way the request and response are successful</p><p>here, the default side effect of this is one cannot from outside can connect to the internal network or hosts directly, as it is obviously not
possible, because it seems non-logical that how can outsider can generate such a packet that can go inside, the only possible way is to have
session established already i.e in the NAT table there should be entry and only traffic from that server will get through.</p><p>Also some ISP don&rsquo;t care about these ranges even,
in fact, my mobile has got ip address 25.23.14.187 from jio ISP, which means that it really doesn&rsquo;t matter at the router end, why?</p><p>Well, suppose this network is <code>/24</code>,
and the interface to which i am connected to i.e gateway is <code>25.23.14.1/24</code>,
now when the router performs NAT and is going to send the packet to the outside, it is going to add the source IP of the interface from which
it is going to forward the packet to the next hop, according to NAT policy, and once the response comes it is for the same router i.e
with the ip address of that interface, then router first may check if any service wants that packet which is listening on its os,
if not, then it will check the NAT table, and there will be the entry then, and according to that entry, it has to send the packet to the interface
with ip 25.23.14.1, and if subnetting done, then next hop else NULL, you got the point,</p><p>but here, don&rsquo;t you think that this is a provider edge router and it also might have entry for the same network for some real world organisation?</p><p>Yes, of course, but you need to understand that this is typically done on the routers which are not performing any BGP and so,
meaning they do have4 publicly routable ip addresses for some of their interfaces, but not necessarily they participate in routing,
i.e they are specifying the default route for to the other routers to send the packets and those routers when got the response, can definitely send
it back towards this router, where, NAT is performed and that 25. something network has opening from that interface, so that router doesn&rsquo;t have
to go to the its gatway or default route again!</p><p>So, the concept of gateway or default route is not just used in the private network but also in such scenarios,
but yes, this is technique used by ISPs today by allocating single public ip address to their such routers and configuring default route to
their main routers which actually participate in BGP topology to exchange routing tables and so on.</p><h2>Related Posts</h2><ul><li><a href=/posts/aws-route53-overview/>An overview of AWS Route53</a></li><li><a href=/posts/nat-vs-pat/>NAT vs. PAT in Networking (In Progress)</a></li><li><a href=/posts/linux-virtual-interfaces/>Linux Virtual Interfaces</a></li></ul><section class=subscribe-content><hr><p>Thank you for reading <i>"How does NAT work?."</i></p><p>Subscribe via <a href=/subscribe>email</a> or
<a href=/index.xml target=_blank>RSS feed</a> to be the first to receive
my content.</p><p>If you liked this post, check out my <a href=/categories/featured>featured posts</a> or learn more <a href=/about>about me</a>.</p></section><section class=subscription-form><form method=post autocomplete=off class=subscribe-form><div class=subscribe-input><input type=email name=EMAIL id=email required placeholder="Email Address ↵" title="Email Address"></div><input value=Subscribe type=submit class=subscribe-button title=Subscribe></form><section class=entry-content><div class=subscribe-message>Get a bimonthly dose of tech news, curated content, and uninterrupted musings.</div></section></section><script>$(".subscribe-form").submit(function(e){e.preventDefault();var t=$(this),n=t.attr("action"),s=t.attr("method");$.ajax({type:s,url:n,data:t.serialize(),dataType:`jsonp`,success:function(e){e.result===`success`?(t.find(".subscribe-button").attr("value","Subscribed!"),$(".subscribe-message").html("Thank you for subscribing! Check your inbox and add me in your contacts to not miss an issue!"),$(".subscribe-form :input").prop("disabled",!0)):(t.find(".subscribe-button").attr("value","Failed to Subscribe! Click again to retry"),$(".subscribe-message").html("There was an error subscribing you to my blog. "+e.msg+"."),t[0].reset()),console.log(e)},error:function(e){console.log("An error occurred."),console.log(e),t[0].reset()}})})</script></div><footer class=post-footer><ul class=post-tags><li><a href=https://belwalkarvarad.tech/tags/networking/>Networking</a></li><li><a href=https://belwalkarvarad.tech/tags/nat/>NAT</a></li></ul><nav class=paginav><a class=prev href=https://belwalkarvarad.tech/posts/reverse-ssh-tunnel/><span class=title>« Prev</span><br><span>Reverse SSH Tunnel</span>
</a><a class=next href=https://belwalkarvarad.tech/posts/ssh-key-for-github/><span class=title>Next »</span><br><span>How to setup custom key for Git to authenticate against remote repo?</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on x" href="https://x.com/intent/tweet/?text=How%20does%20NAT%20work%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&amp;hashtags=Networking%2cNAT"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&amp;title=How%20does%20NAT%20work%3f&amp;summary=How%20does%20NAT%20work%3f&amp;source=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f&title=How%20does%20NAT%20work%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on whatsapp" href="https://api.whatsapp.com/send?text=How%20does%20NAT%20work%3f%20-%20https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on telegram" href="https://telegram.me/share/url?text=How%20does%20NAT%20work%3f&amp;url=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How does NAT work? on ycombinator" href="https://news.ycombinator.com/submitlink?t=How%20does%20NAT%20work%3f&u=https%3a%2f%2fbelwalkarvarad.tech%2fposts%2fnat-overview%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>This work by <a href=https://belwalkarvarad.tech/about/#about-me>Varad Belwalkar</a></span>
<span>is licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>for(var els=document.getElementsByClassName("highlight"),title,code,newNode,i=0;i<els.length;i++)title=els[i].title,code=els[i].firstElementChild.firstElementChild,title.length&&(newNode=document.createElement("div"),newNode.textContent=title,newNode.classList.add("highlight-title"),code.parentNode.insertBefore(newNode,code))</script></body></html>